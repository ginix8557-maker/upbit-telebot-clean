name: Keep Render Alive

on:
  schedule:
    - cron: "*/5 * * * *"   # 5ë¶„ë§ˆë‹¤ ì‹¤í–‰
  workflow_dispatch:

permissions:
  contents: read

env:
  RENDER_URL: ${{ vars.RENDER_URL || 'https://upbit-telebot-clean.onrender.com/' }}

jobs:
  ping:
    runs-on: ubuntu-latest
    timeout-minutes: 1
    steps:
      - name: Ping Render
        id: ping
        run: |
          url="${RENDER_URL%/}/"
          echo "Pinging $url"
          code=$(curl -A "keepalive-gh-actions" -s -o /dev/null -w "%{http_code}" --max-time 7 "$url" || echo 000)
          echo "HTTP $code"
          if [ "$code" != "200" ]; then
            exit 1
          fi

      - name: Notify Telegram on failure
        if: failure()
        env:
          TG_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TG_CHAT:  ${{ secrets.TELEGRAM_CHAT_ID }}
          URL:      ${{ env.RENDER_URL }}
        run: |
          msg="ðŸš¨ Render ping ì‹¤íŒ¨\nURL: ${URL}\nWorkflow: ${GITHUB_WORKFLOW} (#${GITHUB_RUN_NUMBER})"
          curl -s "https://api.telegram.org/bot${TG_TOKEN}/sendMessage" \
            -d chat_id="${TG_CHAT}" \
            --data-urlencode text="${msg}" >/dev/null || true
